---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import "robpins-match-db/styles.css";
import { useTranslations } from "../../../i18n/ui";

export async function getStaticPaths() {
    const matches = await getCollection("matches");
    return matches.map((entry) => ({
        params: { slug: entry.slug },
        props: { entry },
    }));
}

const { entry } = Astro.props;
const { data } = entry;
const { Content } = await entry.render();
const t = useTranslations("es");

const displayDate = data.uploadDate
    ? new Date(data.uploadDate).toLocaleDateString("es-ES", {
          year: "numeric",
          month: "long",
          day: "2-digit",
      })
    : "";

const thumbStyle = data.thumb
    ? `--match-db-thumb: url('${data.thumb}')`
    : undefined;

const title = data.titleEs || data.titleEn;
const description = data.descEs || data.descEn;
---

<BaseLayout title={`${title} â€” Match DB`} description={description} lang="es">
    <div class="match-db-page">
        <div class="match-db-shell">
            <a class="match-db-back" href="/es/database">{t("db.backToDb")}</a>

            <div class="match-db-detail">
                <section class="match-db-detail-card">
                    <div
                        class="match-db-thumb match-db-thumb-large"
                        style={thumbStyle}
                    >
                    </div>
                    <div class="match-db-detail-body">
                        <span class="match-db-eyebrow">{data.source}</span>
                        <h1 class="match-db-title">{title}</h1>
                        <p class="match-db-subtitle">{description}</p>
                        <div class="match-db-meta">
                            <span>{displayDate}</span>
                            <span>{data.duration}</span>
                        </div>
                        <div class="match-db-detail-actions">
                            {
                                data.href && (
                                    <a
                                        class="match-db-button primary"
                                        href={data.href}
                                        target="_blank"
                                        rel="noopener noreferrer"
                                    >
                                        {t("db.viewSource")}
                                    </a>
                                )
                            }
                            <a class="match-db-button" href="/es/database"
                                >{t("db.backToDb")}</a
                            >
                        </div>
                    </div>
                </section>

                <section class="match-db-detail-card">
                    <div class="match-db-detail-body">
                        <h2 class="match-db-title-text">Notas</h2>
                        <div class="match-db-desc">
                            <Content />
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>
</BaseLayout>
